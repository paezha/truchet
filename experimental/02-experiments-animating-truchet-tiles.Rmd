---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(gganimate)
library(sf)
library(tidyverse)
library(truchet)
```


Create four tiles in the same position and bind:
```{r}
df <- rbind(data.frame(st_truchet_p(x = 0, y = 0, type = "fnw"), state = "a"),
            data.frame(st_truchet_p(x = 0, y = 0, type = "fne"), state = "b"),
            data.frame(st_truchet_p(x = 0, y = 0, type = "fse"), state = "c"),
            data.frame(st_truchet_p(x = 0, y = 0, type = "fsw"), state = "d")) %>%
  st_sf()
            
```

```{r}
ggplot() +
  geom_sf(data = df,
          aes(fill = factor(color)),
          color = NA) + 
  facet_wrap(~ state)
```

```{r}
ggplot() +
  geom_sf(data = df,
          aes(fill = factor(color),
              group = state),
          color = NA) + 
  transition_states(state) + 
  ease_aes("cubic-in-out")
```

```{r}
rotation = function(a, x, y, type){
  tile <- st_truchet_p(type = type)
  rm <- matrix(c(cos(a), sin(a), -sin(a), cos(a)), nrow = 2, ncol = 2)
  tile %>%
    mutate(geometry = st_geometry(tile) * rm + c(x, y)) %>%
    st_sf()
} 
```

```{r}
a <- c(seq(0, pi/2, pi/90), 
        rep(pi/2, 45),
       seq(0, pi, pi/90),
       rep(pi, 45))

type <- rep("fnw", length(a))

df <- data.frame()
count <- 0
for(i in a){
  count <- count +1
  df <- rbind(df,
              data.frame(rotation(a = i, x = 3, y = 3, type = "fnw"), state = count))
}

df <- df %>%
  st_sf()
```


Rest of mosaic:
```{r}
xlim <- c(0, 6)
ylim <- c(0, 6)

# Create a data frame with the spots for tiles
container <- expand.grid(x = seq(xlim[1], xlim[2], 1),
                         y = seq(ylim[1], ylim[2], 1)) %>%
  filter(x != 0, y != 0) %>%
  mutate(tiles = sample(c("fnw", "fne", "fse", "fsw"), n(), replace = TRUE),
         scale_p = 1)
```

```{r}
mosaic <- st_truchet_ms(df = container)
```


```{r}
p <- ggplot() +
  geom_sf(data = mosaic,
          aes(fill = factor(color)),
          color = NA) +
   geom_sf(data = df %>% st_sf(),
           aes(fill = factor(color),
               group = state),
           color = NA) + 
  scale_fill_manual(values = c("black", "white")) +
  theme_void() +
  theme(legend.position = "none") +
   transition_time(state) +
  shadow_trail(max_frames = 1)

animate(p, rewind = TRUE)
```

```{r}
anim_save()
```


```{r}
ggplot() +
  geom_sf(data = df %>% st_sf(),
          aes(fill = factor(color)),
          color = NA) +
  facet_wrap(~state)
```
